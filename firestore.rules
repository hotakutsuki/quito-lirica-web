/**
 * This ruleset defines the security model for a public-facing application
 * that collects presentation requests from users.
 *
 * Core Philosophy:
 * The rules implement a secure "dropbox" or "mailbox" pattern. The primary goal
 * is to allow anyone, including unauthenticated users, to submit their contact
 * information and a message via a form. Once submitted, this data is protected
 * from being read, modified, or deleted by any other client. This ensures user
 * privacy and data integrity, assuming the data will be processed by a trusted
 * backend or administrative service.
 *
 * Data Structure:
 * The data is organized into a single, flat, top-level collection:
 * - /presentationRequests/{presentationRequestId}: Stores individual requests.
 *
 * Key Security Decisions:
 * - Public Create: Anyone can create a new document in the `presentationRequests`
 *   collection. This is necessary for the public-facing submission form to work
 *   without requiring users to sign in.
 * - No Client-Side Reads: To protect the privacy of submitted data (names, emails),
 *   all read operations (`get`, `list`) are explicitly denied for clients.
 * - Immutability: Once a request is created, it cannot be modified or deleted
 *   by any client. This prevents tampering with submitted information.
 *
 * Denormalization for Authorization:
 * No denormalization is required. Since write access is public and all other
 * access is denied, there are no authorization decisions that depend on data
 * from other documents.
 *
 * Structural Segregation:
 * Not applicable as there is only one data type with a single, uniform security
 * posture.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description
     *   Allows any user (authenticated or anonymous) to create a presentation
     *   request. It strictly denies any attempts to read, update, or delete
     *   existing requests to protect the privacy of the submitted data.
     * @path
     *   /presentationRequests/{presentationRequestId}
     * @allow
     *   An anonymous user creating a new document in `/presentationRequests`. (create)
     * @deny
     *   Any user, authenticated or not, attempting to read a specific request. (get)
     * @deny
     *   Any user attempting to list all presentation requests. (list)
     * @deny
     *   Any user attempting to modify an existing request after submission. (update)
     * @principle
     *   Implements a secure 'dropbox' model where data can be submitted
     *   publicly but cannot be viewed or modified by clients.
     */
    match /presentationRequests/{presentationRequestId} {
      // READ access is denied to protect user privacy.
      allow get: if false;
      allow list: if false;
      
      // WRITE access is limited to creation only.
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }
  }
}